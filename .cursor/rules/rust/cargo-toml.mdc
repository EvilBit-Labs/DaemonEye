---
globs: Cargo.toml
---

# Cargo.toml Standards for SentinelD

## Workspace Configuration

- Always use **Rust 2024 Edition** (MSRV: 1.85+) as specified in the workspace package
- Use resolver version "3" for dependency resolution
- Enforce lint policy via the canonical manifest lint configuration (RFC 3389) using `[workspace.lints.rust]` so all member crates inherit a single source of truth
  - Member crates must include a `[lints]` table with `workspace = true` to opt into workspace-defined lints
  - We forbid unsafe code globally and deny all warnings to preserve security and signal quality

Example (root `Cargo.toml` excerpt):

```toml
[workspace]
resolver = "3"
members = [
  "procmond",
  "sentinelagent",
  "sentinelcli",
  "sentinel-lib",
]

[workspace.package]
edition = "2024"

[workspace.lints.rust]
unsafe_code = "forbid"
warnings = "deny"

# (Optional) You may add specific future-incompatible or style lints here as they stabilize.

```

Each member crate enables inheritance (e.g. in `sentinel-lib/Cargo.toml`):

```toml
[package]
name = "sentinel-lib"
version = "0.1.0"
edition = "2024"

[lints]
workspace = true
```

Reference: RFC 3389 (Workspace Lint Configuration) for standardized manifest-based lint declarations.

## Dependencies

- Use workspace inheritance for shared dependencies
- Key dependencies should match the specification in [AGENTS.md](mdc:AGENTS.md):
  - `tokio = { version = "1.0", features = ["full"] }`
  - `clap = { version = "4.0", features = ["derive", "completion"] }`
  - `serde = { version = "1.0", features = ["derive"] }`
  - `redb = "2.0"` (primary database)
  - `sysinfo = "0.30"`
  - `tracing = "0.1"`
  - `thiserror = "1.0"`
  - `anyhow = "1.0"`
  - `cargo-nextest = "0.9"` (test runner)
  - `proptest = "1.0"` (property testing)
  - `insta = "1.0"` (snapshot testing)

## Member Crates

- **procmond**: Process monitoring daemon (bin)
- **sentinelcli**: CLI interface (bin)
- **sentinelagent**: Orchestrator agent (bin)
- **sentinel-lib**: Shared library

## Shared Test Dependencies

- Use `assert_cmd = "2.0.17"` for CLI testing
- Use `predicates = "3.1.3"` for test assertions
- Reference via `*.workspace = true` in member crates

## Package Metadata

- Use consistent versioning across workspace
- Include proper license (Apache-2.0)
- Provide clear descriptions for each component
