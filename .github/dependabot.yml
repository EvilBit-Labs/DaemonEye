# Dependabot configuration for automated dependency updates
# https://docs.github.com/github/administering-a-repository/configuration-options-for-dependency-updates

version: 2

registries:
    crates-io:
        type: cargo-registry
        registry: crates-io

updates:
    # Cargo (Rust) dependencies
    - package-ecosystem: "cargo"
      directory: "/"
      schedule:
          interval: "weekly"
          day: "monday"
          time: "06:00"
          timezone: "UTC"
      open-pull-requests-limit: 10
      commit-message:
          prefix: "deps(rust)"
      labels:
          - "dependencies"
          - "rust"
      groups:
          # Group minor/patch updates for common crates
          rust-minor:
              patterns:
                  - "*"
              update-types:
                  - "minor"
                  - "patch"
              exclude-patterns:
                  # Security-critical crates should be updated individually
                  - "rustls*"
                  - "ring"
                  - "blake3"
                  - "chacha20poly1305"
                  - "aes-gcm"
                  - "ed25519-dalek"
                  - "argon2"
          # Tokio ecosystem grouped together
          tokio-ecosystem:
              patterns:
                  - "tokio*"
                  - "tracing*"
                  - "hyper*"
                  - "tower*"
              update-types:
                  - "minor"
                  - "patch"
          # Serde ecosystem grouped together
          serde-ecosystem:
              patterns:
                  - "serde*"
              update-types:
                  - "minor"
                  - "patch"
      ignore:
          # Ignore major version updates for core dependencies (review manually)
          - dependency-name: "tokio"
            update-types: ["version-update:semver-major"]
          - dependency-name: "serde"
            update-types: ["version-update:semver-major"]
          - dependency-name: "clap"
            update-types: ["version-update:semver-major"]
          - dependency-name: "redb"
            update-types: ["version-update:semver-major"]

    # GitHub Actions dependencies
    - package-ecosystem: "github-actions"
      directory: "/"
      schedule:
          interval: "weekly"
          day: "monday"
          time: "06:00"
          timezone: "UTC"
      open-pull-requests-limit: 5
      commit-message:
          prefix: "ci(actions)"
      labels:
          - "dependencies"
          - "github-actions"
          - "ci"
      groups:
          actions-minor:
              patterns:
                  - "*"
              update-types:
                  - "minor"
                  - "patch"

    # Dev containers
    - package-ecosystem: "devcontainers"
      directory: "/"
      schedule:
          interval: "weekly"
          day: "monday"
          time: "06:00"
          timezone: "UTC"
      open-pull-requests-limit: 3
      commit-message:
          prefix: "chore(devcontainer)"
      labels:
          - "dependencies"
          - "devcontainer"
