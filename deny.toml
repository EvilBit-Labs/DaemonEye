# cargo-deny configuration for DaemonEye
# See: https://embarkstudios.github.io/cargo-deny/

[graph]
targets = [
    "aarch64-apple-darwin",
    "aarch64-unknown-linux-gnu",
    "x86_64-unknown-linux-gnu",
    "x86_64-unknown-linux-musl",
    "x86_64-pc-windows-msvc",
]
all-features = true
exclude-dev = true

[licenses]
unused-allowed-license = "allow"
# Allow common open source licenses used in the Rust ecosystem
allow = [
    "Apache-2.0",
    "Apache-2.0 WITH LLVM-exception",
    "CC0-1.0",
    "MIT",
    "BSD-2-Clause",
    "BSD-3-Clause",
    "ISC",
    "Unicode-3.0",
    "Unlicense",
    "Zlib",
    "0BSD",
    "MPL-2.0",
]
include-dev = true

# Confidence threshold for license detection
confidence-threshold = 0.8

[bans]
multiple-versions = "warn"
wildcards = 'allow'
deny = [
    { crate = "git2", use-instead = "gix" },
    { crate = "openssl", use-instead = "rustls" },
    { crate = "openssl-sys", use-instead = "rustls" },
    "libssh2-sys",
    { crate = "cmake", use-instead = "cc" },
]
skip = []

# Whitelist Windows dependency conflicts for cross-platform compatibility
# These conflicts arise from different dependency chains:
# - sysinfo v0.37.2 → windows v0.61.3 (older Windows crates)
# - chrono v0.4.42 → iana-time-zone → windows-core v0.62.2 (newer Windows crates)
# - interprocess v2.2.3 → windows-sys v0.52.0 (legacy Windows crates)
# - tokio ecosystem → various windows-sys versions
# TODO: Monitor for resolution as dependencies update
skip-tree = [
    # Windows core dependencies (actual versions from Cargo.lock)
    { name = "windows", version = "=0.61.3" },
    { name = "windows-collections", version = "=0.2.0" },
    { name = "windows-core", version = "=0.61.2" },
    { name = "windows-core", version = "=0.62.2" },
    { name = "windows-future", version = "=0.2.1" },
    { name = "windows-implement", version = "=0.60.2" },
    { name = "windows-interface", version = "=0.59.3" },
    { name = "windows-link", version = "=0.1.3" },
    { name = "windows-link", version = "=0.2.1" },
    { name = "windows-numerics", version = "=0.2.0" },
    { name = "windows-result", version = "=0.3.4" },
    { name = "windows-result", version = "=0.4.1" },
    { name = "windows-strings", version = "=0.4.2" },
    { name = "windows-strings", version = "=0.5.1" },
    { name = "windows-sys", version = "=0.52.0" },
    { name = "windows-sys", version = "=0.59.0" },
    { name = "windows-sys", version = "=0.60.2" },
    { name = "windows-sys", version = "=0.61.2" },
    { name = "windows-targets", version = "=0.52.6" },
    { name = "windows-targets", version = "=0.53.5" },
    { name = "windows_x86_64_gnu", version = "=0.52.6" },
    { name = "windows_x86_64_gnu", version = "=0.53.1" },
    { name = "windows_x86_64_msvc", version = "=0.52.6" },
    { name = "windows_x86_64_msvc", version = "=0.53.1" },
]


[advisories]
yanked = "deny"
# Allow unmaintained crates from workspace but with explicit exceptions
unmaintained = "workspace"

# Advisory handling is managed via audit.toml
# cargo-deny relies on cargo-audit for advisory detection

# Ignored advisories with justification
ignore = [
    # bincode: The team considers version 1.3.3/2.0.1 complete and not needing updates.
    # This is an unmaintained advisory, not a security vulnerability.
    # TODO: Consider migrating to postcard or bitcode when time permits.
    "RUSTSEC-2025-0141",

    # atomic-polyfill: Unmaintained but pulled in by postcard 1.1.3 → heapless 0.7.17.
    # Not a security vulnerability, just unmaintained. Upstream postcard has merged
    # heapless 0.9 support (PR #269) but no 1.x release yet.
    # TODO: Remove when postcard 1.2+ releases with heapless 0.9 (uses portable-atomic).
    # Tracking: https://github.com/jamesmunns/postcard/issues/223
    "RUSTSEC-2023-0089",
]

[sources]
# Allow crates from crates.io
unknown-registry = "deny"
unknown-git = "deny"
allow-registry = ["https://github.com/rust-lang/crates.io-index"]

[sources.allow-org]
# Allow specific organizations for git sources if needed
github = []
gitlab = []
bitbucket = []
